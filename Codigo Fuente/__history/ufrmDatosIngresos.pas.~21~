unit ufrmDatosIngresos;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, ExtCtrls, DateUtils, cxGraphics, cxLookAndFeels,
  cxLookAndFeelPainters, Menus, dxSkinsCore, dxSkinBlack, dxSkinBlue,
  dxSkinCaramel, dxSkinCoffee, dxSkinDarkRoom, dxSkinDarkSide, dxSkinFoggy,
  dxSkinGlassOceans, dxSkiniMaginary, dxSkinLilian, dxSkinLiquidSky,
  dxSkinLondonLiquidSky, dxSkinMcSkin, dxSkinMoneyTwins, dxSkinOffice2007Black,
  dxSkinOffice2007Blue, dxSkinOffice2007Green, dxSkinOffice2007Pink,
  dxSkinOffice2007Silver, dxSkinPumpkin, dxSkinSeven, dxSkinSharp, dxSkinSilver,
  dxSkinSpringTime, dxSkinStardust, dxSkinSummer2008, dxSkinsDefaultPainters,
  dxSkinValentine, dxSkinXmas2008Blue, cxButtons, ComCtrls,
  uDAScriptingProvider, uDADataTable, uDAMemDataTable, cxControls,
  dxSkinscxPCPainter, cxStyles, cxCustomData, cxFilter, cxData, cxDataStorage,
  cxEdit, DB, cxDBData, cxDBLookupComboBox, cxTextEdit, cxGridLevel,
  cxGridCustomTableView, cxGridTableView, cxGridDBTableView, cxClasses,
  cxGridCustomView, cxGrid, cxPC, cxContainer, cxDBLabel, cxLabel,
  uDAInterfaces, uDACDSDataTable, uDARemoteDataAdapter;

type
  TfrmDatosIngresos = class(TForm)
    Panel1: TPanel;
    Pa_ayuda: TPanel;
    Bevel1: TBevel;
    Button2: TButton;
    pgcConceptos: TcxPageControl;
    Conceptos: TcxTabSheet;
    dbgConceptos: TcxGrid;
    dbgConceptosDBTableView1: TcxGridDBTableView;
    Descripcion: TcxGridDBColumn;
    Producto: TcxGridDBColumn;
    Precio: TcxGridDBColumn;
    LtsInicio: TcxGridDBColumn;
    LtsFinal: TcxGridDBColumn;
    Cantidad: TcxGridDBColumn;
    Jarreos: TcxGridDBColumn;
    Entregado: TcxGridDBColumn;
    Importe: TcxGridDBColumn;
    dbgConceptosLevel1: TcxGridLevel;
    cxTabSheet2: TcxTabSheet;
    dbgCreditosDebitosCupones: TcxGrid;
    cxGridDBTableView2: TcxGridDBTableView;
    Tarjetas: TcxGridDBColumn;
    Ticket: TcxGridDBColumn;
    CreditosProducto: TcxGridDBColumn;
    CreditosCantidad: TcxGridDBColumn;
    CreditosImporte: TcxGridDBColumn;
    cxGridLevel2: TcxGridLevel;
    cxTabSheet1: TcxTabSheet;
    dbgProductos: TcxGrid;
    cxGridDBTableView1: TcxGridDBTableView;
    ProductoDescripcion: TcxGridDBColumn;
    ProductoPrecio: TcxGridDBColumn;
    Recibido: TcxGridDBColumn;
    Resurtido: TcxGridDBColumn;
    ProductoEntregado: TcxGridDBColumn;
    ProductoCantidad: TcxGridDBColumn;
    ProductoImporte: TcxGridDBColumn;
    cxGridLevel1: TcxGridLevel;
    cxTabSheet3: TcxTabSheet;
    dbgClientes: TcxGrid;
    cxGridDBTableView3: TcxGridDBTableView;
    IDCliente: TcxGridDBColumn;
    ClienteNombre: TcxGridDBColumn;
    ClienteTicket: TcxGridDBColumn;
    ClienteImporte: TcxGridDBColumn;
    cxGridLevel3: TcxGridLevel;
    cxTabSheet4: TcxTabSheet;
    dbgEfectivo: TcxGrid;
    cxGridDBTableView4: TcxGridDBTableView;
    EfectivoDescripcion: TcxGridDBColumn;
    EfectivoCantidad: TcxGridDBColumn;
    EfectivoImporte: TcxGridDBColumn;
    cxGridLevel4: TcxGridLevel;
    cxTabSheet5: TcxTabSheet;
    dbgSalidaEfectivos: TcxGrid;
    cxGridDBTableView5: TcxGridDBTableView;
    SalidaEfectivoDescripcion: TcxGridDBColumn;
    SalidaEfectivoImporte: TcxGridDBColumn;
    cxGridLevel5: TcxGridLevel;
    cxLabel3: TcxLabel;
    cxDBLabel1: TcxDBLabel;
    cxLabel4: TcxLabel;
    cxDBLabel2: TcxDBLabel;
    cxLabel5: TcxLabel;
    cxDBLabel3: TcxDBLabel;
    cxLabel6: TcxLabel;
    cxDBLabel4: TcxDBLabel;
    cdsDetalleIngreso: TDACDSDataTable;
    cdsIngresos: TDACDSDataTable;
    dsIngresos: TDADataSource;
    dsDetalleIngreso: TDADataSource;
    procedure Button2Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure pgcConceptosPageChanging(Sender: TObject; NewPage: TcxTabSheet;
      var AllowChange: Boolean);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FoDatosIngresos: TfrmDatosIngresos;
  NUMEROESTACIONL,IDTURNOL: Integer;

procedure Abrir_DatoIngresos(NUMEROESTACION, IDTURNO: Integer);

implementation
uses  uDM, LibraryIngresos_Intf;

{$R *.dfm}

procedure Abrir_DatoIngresos(NUMEROESTACION, IDTURNO: Integer);
Begin
  FoDatosIngresos:=TfrmDatosIngresos.Create(Application);
  NUMEROESTACIONL:= NUMEROESTACION;
  IDTURNOL:= IDTURNO;

  FoDatosIngresos.ShowModal;

  FoDatosIngresos.Free;
End;

procedure TfrmDatosIngresos.Button2Click(Sender: TObject);
begin
  Close;
end;

procedure TfrmDatosIngresos.FormShow(Sender: TObject);
var
  s: String;
begin
  cdsIngresos.Close;
  cdsIngresos.ParamByName('NUMEROESTACION').AsInteger:= NUMEROESTACIONL;
  cdsIngresos.ParamByName('IDTURNO').AsInteger:= IDTURNOL;
  cdsIngresos.Open;

  cdsDetalleIngreso.Close;
  cdsDetalleIngreso.ParamByName('IDINGRESO').AsInteger:= cdsIngresos.FieldByName('IDINGRESO').AsInteger;
  cdsDetalleIngreso.Open;

  if pgcConceptos.ActivePageIndex in [0..5] then
  begin
    case pgcConceptos.ActivePageIndex of
    0: begin s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(DM.ESCOMBUSTIBLE) +''''; end;
    1: begin s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(DM.ESCREDITODEBITOCUPON) +''''; end;
    2: begin s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(DM.ESPRODUCTO) +''''; end;
    3: begin s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(DM.ESCLIENTE) +''''; end;
    4: begin s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(DM.ESEFECTIVO) +''''; end;
    5: begin s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(DM.ESSALIDAEFECTIVO) +''''; end;
  end;
  cdsDetalleIngreso.Filtered:=False;
  cdsDetalleIngreso.Filter:=s;
  cdsDetalleIngreso.Filtered:=True;
  end;
end;

procedure TfrmDatosIngresos.pgcConceptosPageChanging(Sender: TObject;
  NewPage: TcxTabSheet; var AllowChange: Boolean);
var
 s: String;
begin
  inherited;
  case NewPage.PageIndex of
    0: begin IDTIPOVALOR:= ESCOMBUSTIBLE; s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(ESCOMBUSTIBLE) +''''; end;
    1: begin IDTIPOVALOR:= ESCREDITODEBITOCUPON; s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(ESCREDITODEBITOCUPON) +''''; end;
    2: begin IDTIPOVALOR:= ESPRODUCTO; s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(ESPRODUCTO) +''''; end;
    3: begin IDTIPOVALOR:= ESCLIENTE; s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(ESCLIENTE) +''''; end;
    4: begin IDTIPOVALOR:= ESEFECTIVO; s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(ESEFECTIVO) +''''; end;
    5: begin IDTIPOVALOR:= ESSALIDAEFECTIVO; s:= 'IDTIPOCOMPROBACION = '''+ INTTOSTR(ESSALIDAEFECTIVO) +''''; end;
  end;

  cdsDetalleIngreso.Filtered:=False;
  cdsDetalleIngreso.Filter:=s;
  cdsDetalleIngreso.Filtered:=True;
end;

end.
