unit ufrmBuscarTarjetasAditivos;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, ExtCtrls, DateUtils, cxGraphics, cxLookAndFeels,
  cxLookAndFeelPainters, Menus, dxSkinsCore, dxSkinBlack, dxSkinBlue,
  dxSkinCaramel, dxSkinCoffee, dxSkinDarkRoom, dxSkinDarkSide, dxSkinFoggy,
  dxSkinGlassOceans, dxSkiniMaginary, dxSkinLilian, dxSkinLiquidSky,
  dxSkinLondonLiquidSky, dxSkinMcSkin, dxSkinMoneyTwins, dxSkinOffice2007Black,
  dxSkinOffice2007Blue, dxSkinOffice2007Green, dxSkinOffice2007Pink,
  dxSkinOffice2007Silver, dxSkinPumpkin, dxSkinSeven, dxSkinSharp, dxSkinSilver,
  dxSkinSpringTime, dxSkinStardust, dxSkinSummer2008, dxSkinsDefaultPainters,
  dxSkinValentine, dxSkinXmas2008Blue, cxButtons, ComCtrls,
  uDAScriptingProvider, uDADataTable, uDAMemDataTable, cxControls, cxStyles,
  dxSkinscxPCPainter, cxCustomData, cxFilter, cxData, cxDataStorage, cxEdit, DB,
  cxDBData, dxSkinsdxRibbonPainter, cxContainer, cxGroupBox, uDAInterfaces,
  uDARemoteDataAdapter, uDACDSDataTable, dxRibbon, cxGridLevel,
  cxGridCustomTableView, cxGridTableView, cxGridDBTableView, cxClasses,
  cxGridCustomView, cxGrid, LibraryFlotillas_Intf;

type
  TDatosBusqueda = record
    OK:Boolean;
    Clave, FormaPago, Tipo:Integer;
    Cuenta, RFC, Nombre: String;
    Estatus : Variant;
    Importe: Float;
  end;

type
  TfrmBuscarTarjetasAdivitos = class(TForm)
    Panel1: TPanel;
    dbgAgrupacion: TcxGrid;
    cxGridDBTableView1: TcxGridDBTableView;
    cxGridLevel1: TcxGridLevel;
    dxRibbon1: TdxRibbon;
    cdsBuscar: TDACDSDataTable;
    rdaTarjetasAditivos: TDARemoteDataAdapter;
    dsBuscar: TDADataSource;
    cxGroupBox1: TcxGroupBox;
    cxButton1: TcxButton;
    cxButton2: TcxButton;
    procedure Button2Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmBuscarTarjetasAdivitos: TfrmBuscarTarjetasAdivitos;
  Cliente: Integer;

function Abrir_BuscarTarjetaAditivos(ClienteID: Integer):TDatosBusqueda;

implementation
uses UDMFlotillas, uDM;

{$R *.dfm}

function Abrir_BuscarTarjetaAditivos(ClienteID: Integer):TDatosBusqueda;
Begin
  frmBuscarTarjetasAdivitos:=TfrmBuscarTarjetasAdivitos.Create(Application);
  Cliente:= ClienteID;
  frmBuscarTarjetasAdivitos.ShowModal;

  Result:= '';
  frmBuscarTarjetasAdivitos.Free;
End;

procedure TfrmBuscarTarjetasAdivitos.Button2Click(Sender: TObject);
begin
  Close;
end;

procedure TfrmBuscarTarjetasAdivitos.FormShow(Sender: TObject);
var
  S: String;
  P: TParametrosF;
begin
  cdsBuscar.Close;

  P:= TParametrosF.Create;
  DMFlotillas.ConectaServer(DM.NumeroEstacion);

  P.ClienteIni := Cliente;

  S:= 'SELECT  Vehiculo.VehiculoID, Vehiculo.ClienteID, Vehiculo.Nombre '+
      'FROM  Vehiculo INNER JOIN CLIENTE ON CLIENTE.CLIENTEID = VEHICULO.CLIENTEID '+
      'WHERE (Vehiculo.ClienteID = @ClienteIni) and (Vehiculo.Nombre = ''ADITIVOS'') ';
  rdaTarjetasAditivos.GetDataCall.ParamByName('SQL').AsString:=S;
  rdaTarjetasAditivos.GetDataCall.ParamByName('Parametros').AsComplexType:= P;
  cdsBuscar.Open;
  cxGridDBTableView1.ClearItems;
  cxGridDBTableView1.DataController.CreateAllItems();

end;

end.
