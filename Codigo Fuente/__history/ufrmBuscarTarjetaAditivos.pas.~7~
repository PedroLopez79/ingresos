unit ufrmBuscarTarjeta;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ufrmBuscar, cxStyles, cxCustomData, cxGraphics, cxFilter, cxData, cxDataStorage,
  cxEdit, DB, cxDBData, Menus, cxLookAndFeelPainters, uDADataTable,
  uDAScriptingProvider, uDACDSDataTable, dxRibbon, StdCtrls, cxButtons,
  ExtCtrls, cxGridLevel, cxClasses, cxControls, cxGridCustomView,
  cxGridCustomTableView, cxGridTableView, cxGridDBTableView, cxGrid,
  dxStatusBar, dxRibbonStatusBar, dxSkinsCore, dxSkinsDefaultPainters,
  dxSkinscxPCPainter, dxSkinsdxRibbonPainter, uDAInterfaces, cxContainer,
  cxGroupBox, dxSkinBlack, dxSkinBlue, dxSkinCaramel, dxSkinCoffee,
  dxSkinGlassOceans, dxSkiniMaginary, dxSkinLilian, dxSkinLiquidSky,
  dxSkinLondonLiquidSky, dxSkinMcSkin, dxSkinMoneyTwins, dxSkinOffice2007Black,
  dxSkinOffice2007Blue, dxSkinOffice2007Green, dxSkinOffice2007Pink,
  dxSkinOffice2007Silver, dxSkinSilver, dxSkinStardust, dxSkinValentine,
  dxSkinXmas2008Blue, cxLookAndFeels, dxSkinDarkSide,
  dxSkinPumpkin, dxSkinSpringTime, LibraryIngresos_Intf,
  dxSkinSummer2008, dxSkinDarkRoom, dxSkinFoggy, dxSkinSeven, dxSkinSharp,
  uDARemoteDataAdapter;

type
  TfrmBuscarTarjetaAditivos = class(TfrmBuscar)
    cxGridDBTableView1Column1: TcxGridDBColumn;
    cxGridDBTableView1Column2: TcxGridDBColumn;
    cxGridDBTableView1Column3: TcxGridDBColumn;
    rdaTarjetasAditivos: TDARemoteDataAdapter;
    procedure FormShow(Sender: TObject);
    procedure cxGridDBTableView1CellDblClick(Sender: TcxCustomGridTableView;
      ACellViewInfo: TcxGridTableDataCellViewInfo; AButton: TMouseButton;
      AShift: TShiftState; var AHandled: Boolean);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmBuscarTarjetaAditivos: TfrmBuscarTarjetaAditivos;

implementation

{$R *.dfm}

procedure TfrmBuscarTarjetaAditivos.cxGridDBTableView1CellDblClick(
  Sender: TcxCustomGridTableView; ACellViewInfo: TcxGridTableDataCellViewInfo;
  AButton: TMouseButton; AShift: TShiftState; var AHandled: Boolean);
begin
  Datos.Clave:=cdsBuscar.FieldByName('VehiculoID').AsInteger;
  Datos.Nombre:= cdsBuscar.FieldByName('Nombre').AsString;
  Datos.Tipo:=cdsBuscar.FieldByName('FormaCompraID').AsInteger;
  //Datos.Estatus := cdsBuscar.FieldByName('Estatus').AsString;
  Datos.Estatus := 'A';
  inherited;
end;

procedure TfrmBuscarTarjetaAditivos.FormShow(Sender: TObject);
var
  S: String;
  P: TParametrosF;
begin
  cdsConsumos.Close;
  cdsHorasCortes.Close;

  if IDINGRESO > 0 then
  begin
  Try
  P2:= TParametrosF.Create;
  DMCistemGas.ConectaServer(DM.NumeroEstacion);
  DMFlotillas.ConectaServer(DM.NumeroEstacion);
  
  P2.ClienteIni := IDINGRESO;
  P2.EstacionIni:= DM.NumeroEstacion;

  P:= TParametros.Create;
  P.TurnoID:= IDINGRESO;

  if DM.VERSIONVOLUMETRICO = 'STANDARD' then
  BEGIN
  S:= 'SELECT  SecuenciaVenta as  TramaID,'+
      'PosicionCarga as BombaID,'+
      'Cantidad as Volumen, ProductoID, Precio, Importe, Tarjeta as Referencia '+
      'FROM  Consumo '+
      'WHERE (Turno = @ClienteIni)and(EstacionID = @EstacionIni)';
  rdaConsumos.GetDataCall.ParamByName('SQL').AsString:=S;
  rdaConsumos.GetDataCall.ParamByName('Parametros').AsComplexType:= P2;
  cdsConsumos.Open;
  inherited;
  cdsBuscar.Close;
  cdsBuscar.ParamByName('ClienteID').AsInteger:= strtoint(Copy(CRITERIO, 1, length(CRITERIO)-1));
  cdsBuscar.Open;
end;

end.
