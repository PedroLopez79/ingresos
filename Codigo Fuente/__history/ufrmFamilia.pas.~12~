unit ufrmFamilia;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ufrmCatalogo, cxGraphics, cxControls, cxLookAndFeels,
  cxLookAndFeelPainters, dxSkinsCore, dxSkinBlack, dxSkinBlue, dxSkinCaramel,
  dxSkinCoffee, dxSkinDarkRoom, dxSkinDarkSide, dxSkinFoggy, dxSkinGlassOceans,
  dxSkiniMaginary, dxSkinLilian, dxSkinLiquidSky, dxSkinLondonLiquidSky,
  dxSkinMcSkin, dxSkinMoneyTwins, dxSkinOffice2007Black, dxSkinOffice2007Blue,
  dxSkinOffice2007Green, dxSkinOffice2007Pink, dxSkinOffice2007Silver,
  dxSkinPumpkin, dxSkinSeven, dxSkinSharp, dxSkinSilver, dxSkinSpringTime,
  dxSkinStardust, dxSkinSummer2008, dxSkinsDefaultPainters, dxSkinValentine,
  dxSkinXmas2008Blue, dxSkinscxPCPainter, cxStyles, cxCustomData, cxFilter,
  cxData, cxDataStorage, cxEdit, DB, cxDBData, dxmdaset, uDAInterfaces,
  uDADataTable, uDAScriptingProvider, uDAMemDataTable, cxGridLevel, cxClasses,
  cxGridCustomView, cxGridCustomTableView, cxGridTableView, cxGridDBTableView,
  cxGrid, cxPC, cxContainer, StdCtrls, cxTextEdit, cxDBEdit, ExtCtrls, Menus,
  cxButtons, Modules, cxDBLookupComboBox, cxGroupBox, dmActions, LibraryGauss_Intf;

type
  TfrmFamilia = class(TfrmCatalogo)
    Panel1: TPanel;
    Panel2: TPanel;
    cxPageControl1: TcxPageControl;
    cxTabSheet4: TcxTabSheet;
    cxDBTextEdit1: TcxDBTextEdit;
    cxDBTextEdit2: TcxDBTextEdit;
    cxDBTextEdit3: TcxDBTextEdit;
    cxDBTextEdit4: TcxDBTextEdit;
    cxDBTextEdit5: TcxDBTextEdit;
    cxTabSheet7: TcxTabSheet;
    cxDBTextEdit11: TcxDBTextEdit;
    cxDBTextEdit12: TcxDBTextEdit;
    cxDBTextEdit13: TcxDBTextEdit;
    cxDBTextEdit14: TcxDBTextEdit;
    Label1: TLabel;
    cxDBTextEdit6: TcxDBTextEdit;
    cxDBTextEdit7: TcxDBTextEdit;
    cxDBTextEdit8: TcxDBTextEdit;
    cdsFamilia: TDAMemDataTable;
    dsFamilia: TDADataSource;
    cdsAlumnos: TDAMemDataTable;
    dsAlumnos: TDADataSource;
    cxGroupBox1: TcxGroupBox;
    cxGrid1: TcxGrid;
    cxGrid1DBTableView1: TcxGridDBTableView;
    cxGrid1DBTableView1NOCONTROL: TcxGridDBColumn;
    cxGrid1DBTableView1NOMBRE: TcxGridDBColumn;
    cxGrid1Level1: TcxGridLevel;
    btnAgregar: TcxButton;
    btnEliminar: TcxButton;
    Label13: TLabel;
    Label2: TLabel;
    Label4: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    Label10: TLabel;
    Label3: TLabel;
    Label9: TLabel;
    Label11: TLabel;
    dbgCatalogoDBTableView1IDFAMILIA: TcxGridDBColumn;
    dbgCatalogoDBTableView1CODIGO: TcxGridDBColumn;
    dbgCatalogoDBTableView1NOMBRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1PADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1MADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1TELEFONOCASA: TcxGridDBColumn;
    dbgCatalogoDBTableView1TELEFONOPADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1TELEFONOMADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1EMAILPADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1EMAILMADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1FACTURADOMICILIO: TcxGridDBColumn;
    dbgCatalogoDBTableView1FACTURANOMBRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1FACTURATELEFONO: TcxGridDBColumn;
    dbgCatalogoDBTableView1RFC: TcxGridDBColumn;
    dbgCatalogoDBTableView1EMPRESAPADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1EMPRESAMADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1PUESTOMADRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1PUESTOPADRE: TcxGridDBColumn;
    cxDBTextEdit9: TcxDBTextEdit;
    Label12: TLabel;
    Label14: TLabel;
    cxDBTextEdit10: TcxDBTextEdit;
    Label15: TLabel;
    cxDBTextEdit15: TcxDBTextEdit;
    Label16: TLabel;
    cxDBTextEdit16: TcxDBTextEdit;
    Label5: TLabel;
    procedure cdsCatalogoNewRecord(DataTable: TDADataTable);
    procedure btnAgregarClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure btnEliminarClick(Sender: TObject);
  protected
    procedure RegisterActions; override;
  private
    { Private declarations }
    procedure ActionImprimir(Action: TBasicAction); override;
  public
    { Public declarations }
  end;

var
  frmFamilia: TfrmFamilia;

implementation
uses uDM;

{$R *.dfm}

procedure TfrmFamilia.ActionImprimir(Action: TBasicAction);
var
    Rep: LibraryGauss_Intf.TReporteF;
begin
  //-- envio del reporte--//
    Rep:=DM.Servidor.BuscarReporte('Catalogo de Empresas');
    DM.Parametros.Factura:=0;
    try
     DM.Imprimir(Rep.SQL1, Rep.SQL2, Rep.Template, 'IMPRIMIENDO...', Rep.CampoJoin, False)
    finally
     Rep.Free;
    end;
end;

procedure TfrmFamilia.btnAgregarClick(Sender: TObject);
begin
  inherited;
  cdsFamilia.Insert;
  cdsFamilia.FieldByName('IDFAMILIAALUMNO').AsInteger:= DM.Servidor.Folio('IDFAMILIAALUMNO','');
  cdsFamilia.FieldByName('IDFAMILIA').AsInteger:= cdsCatalogo.FieldByName('IDFAMILIA').AsInteger;
  cdsCatalogo.Edit;
end;

procedure TfrmFamilia.btnEliminarClick(Sender: TObject);
begin
  inherited;
  cdsFamilia.Delete;
  cdsCatalogo.Edit;
end;

procedure TfrmFamilia.cdsCatalogoNewRecord(DataTable: TDADataTable);
begin
  inherited;
  cdsCatalogo.FieldByName('IDFAMILIA').AsInteger:= DM.Servidor.Folio('IDFAMILIA','');

end;

procedure TfrmFamilia.FormCreate(Sender: TObject);
begin
  inherited;
  cdsFamilia.Close;
  cdsFamilia.Open;

  cdsAlumnos.Close;
  cdsAlumnos.Open;
end;

procedure TfrmFamilia.RegisterActions;
begin
  inherited;
  RegisterAction(AppActions.actImprimir, ActionImprimir);
end;

initialization
  ModuleInfoManager.RegisterModule('Familias', TfrmFamilia);

end.
