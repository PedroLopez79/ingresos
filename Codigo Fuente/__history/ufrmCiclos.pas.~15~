unit ufrmCiclos;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ufrmCatalogo, cxGraphics, cxControls, cxLookAndFeels,
  cxLookAndFeelPainters, dxSkinsCore, dxSkinBlack, dxSkinBlue, dxSkinCaramel,
  dxSkinCoffee, dxSkinDarkRoom, dxSkinDarkSide, dxSkinFoggy, dxSkinGlassOceans,
  dxSkiniMaginary, dxSkinLilian, dxSkinLiquidSky, dxSkinLondonLiquidSky,
  dxSkinMcSkin, dxSkinMoneyTwins, dxSkinOffice2007Black, dxSkinOffice2007Blue,
  dxSkinOffice2007Green, dxSkinOffice2007Pink, dxSkinOffice2007Silver,
  dxSkinPumpkin, dxSkinSeven, dxSkinSharp, dxSkinSilver, dxSkinSpringTime,
  dxSkinStardust, dxSkinSummer2008, dxSkinsDefaultPainters, dxSkinValentine,
  dxSkinXmas2008Blue, dxSkinscxPCPainter, cxStyles, cxCustomData, cxFilter,
  cxData, cxDataStorage, cxEdit, DB, cxDBData, dxmdaset, uDAInterfaces,
  uDADataTable, uDAScriptingProvider, uDAMemDataTable, cxGridLevel, cxClasses,
  cxGridCustomView, cxGridCustomTableView, cxGridTableView, cxGridDBTableView,
  cxGrid, cxPC, cxContainer, Menus, StdCtrls, cxButtons, cxMaskEdit,
  cxDropDownEdit, cxCalendar, cxDBEdit, cxTextEdit, cxLabel, ExtCtrls, Modules,
  dmActions, LibraryGauss_Intf;

type
  TfrmCiclos = class(TfrmCatalogo)
    Panel1: TPanel;
    cxLabel1: TcxLabel;
    cxDBTextEdit1: TcxDBTextEdit;
    cxLabel3: TcxLabel;
    cxDBTextEdit3: TcxDBTextEdit;
    cxLabel2: TcxLabel;
    cxDBTextEdit2: TcxDBTextEdit;
    cxLabel9: TcxLabel;
    cxDBDateEdit1: TcxDBDateEdit;
    cxLabel5: TcxLabel;
    cxDBDateEdit2: TcxDBDateEdit;
    btnInciarCiclo: TcxButton;
    cxLabel4: TcxLabel;
    cxDBTextEdit4: TcxDBTextEdit;
    dbgCatalogoDBTableView1RecID: TcxGridDBColumn;
    dbgCatalogoDBTableView1IDCICLO: TcxGridDBColumn;
    dbgCatalogoDBTableView1CODIGO: TcxGridDBColumn;
    dbgCatalogoDBTableView1NOMBRE: TcxGridDBColumn;
    dbgCatalogoDBTableView1FECHAINICIO: TcxGridDBColumn;
    dbgCatalogoDBTableView1FECHAFINAL: TcxGridDBColumn;
    dbgCatalogoDBTableView1NOMBREAUX1: TcxGridDBColumn;
    dbgCatalogoDBTableView1NOMBREAUX2: TcxGridDBColumn;
    Panel2: TPanel;
    procedure btnInciarCicloClick(Sender: TObject);
    procedure cdsCatalogoNewRecord(DataTable: TDADataTable);
  protected
    procedure RegisterActions; override;
  private
    { Private declarations }
    procedure ActionImprimir(Action: TBasicAction); override;
  public
    { Public declarations }
  end;

var
  frmCiclos: TfrmCiclos;

implementation

uses uDM;

{$R *.dfm}

procedure TfrmCiclos.ActionImprimir(Action: TBasicAction);
var
    Rep: LibraryGauss_Intf.TReporteF;
begin
  //-- envio del reporte--//
    Rep:=DM.Servidor.BuscarReporte('Catalogo de Bancos');
    DM.Parametros.Factura:=0;
    try
     DM.Imprimir(Rep.SQL1, Rep.SQL2, Rep.Template, 'IMPRIMIENDO...', Rep.CampoJoin, False)
    finally
     Rep.Free;
    end;
end;

procedure TfrmCiclos.btnInciarCicloClick(Sender: TObject);
begin
  inherited;
  IF DM.Servidor.IniciaCiclo(cdsCatalogo.FieldByName('IDCICLO').AsString) THEN
     showmessage('Ciclo Iniciado')
  else
     Showmessage('El ciclo no fue inicializado');
end;

procedure TfrmCiclos.cdsCatalogoNewRecord(DataTable: TDADataTable);
begin
  inherited;
  cdsCatalogo.FieldByName('IDCICLO').AsInteger:= DM.Servidor.Folio('IDCICLO','');
end;

procedure TfrmCiclos.RegisterActions;
begin
  inherited;
  RegisterAction(AppActions.actImprimir, ActionImprimir);
end;

initialization
  ModuleInfoManager.RegisterModule('Ciclos', TfrmCiclos);

end.
